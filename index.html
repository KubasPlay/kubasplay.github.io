<!DOCTYPE html>
<html lang="pl">
<head>
<link rel="stylesheet" href="style.css">
<link href='https://fonts.googleapis.com/css?family=Lato' rel='stylesheet'>
<title>SRS 2.0</title>
<link rel="icon" type="image/x-icon" href="https://i.imgur.com/G9xBmvt.png">
</head>

<body>

<div id="err-login-page" class="login-page">
	</br></br></br>
	<h1>Błędny login/hasło!</h1>
</div>

<div id="login-page" class="login-page">
	</br>
	<h3>Logowanie</h3>
	  <input type="text" class="loginform" id="loginInp" placeholder="Login" onsubmit="return getPass()" autocomplete=off>
	  </br></br>
	  <input type="password" class="loginform" id="passInp" placeholder="Hasło">
	  </br></br>
</div>

<div id="content" class="content">
	<div class="page0">
		<center>
			</br></br></br></br>
			<h1>Witamy w SRS 2.0</h1>
			<h2>Wybierz kategorię z menu</h2>
		</center>
		</br></br></br></br></br></br>
		<h2>Jak korzystać z nowego Systemu Rekrutacji Serwerowej?</h2>
		<p>Wybierz z menu po lewej stronie interesującą cię kategorię. W zakładce Nowe wnioski możesz sprawdzać niezweryfikowane zgłoszenia. Weryfikacja testów pozwala na sprawdzenie poprawności odpowiedzi w wykonywanym przez osobę rekrutowaną teście. Uruchom widok tabeli, aby zobaczyć wszystkie zgłoszenia.</p>
		</br></br>
		<h2>Jak odświeżyć bazę danych?</h2>
		<p>Kliknij ponownie na aktualnie otwartą zakładkę w menu, aby odświeżyć informacje z bazy danych.</p>
	</div>
	<div class="page1">
		<h1>Nowe wnioski</h1>
	</div>
	<div class="page2">
		<h1>Weryfikacja testów</h1>
	</div>
	<div class="page3">
		<h1>Widok tabeli</h1>
		</br>
		<div id="tabelka">
		</div>
	</div>
	<div class="page4">
		<h1>Edycja wniosku</h1>
		</br>
		<div id="edycja">
		</div>
	</div>
	<div class="page5">
		<h1>Statystyki</h1>
	</div>
	<div class="prof">
		<h1>Profil</h1>
		</br></br></br></br>
		<h2>Nazwa użytkownika</h2>
		<p id="profilename">-</p>
	</div>
	<div class="reload">
		<center>
		</br></br></br>
		<h1>Trwa aktualizacja</h1>
		<h2>Prosimy nie zamykać systemu SRS!</h2>
		</center>
	</div>

</div>
<div id="menu" class="menu">
	<div class="menu-pos" id="prof" onClick="return prof()">
		<div class="profile-icon">
			<img name="userpic" width="50px" style="border-radius: 50%;"></img>
		</div>
		<span id="user" class="menu-content"></span>
	</div>
	<div class="menu-pos" onClick='window.open("https://kubasplay.github.io/","_self")'>
		<div class="menu-icon">
			<img width="40px" src="https://i.imgur.com/YOBwBcP.png"></img>
		</div>
		<span class="menu-content">Wyloguj</span>
	</div>
	<hr class="profile-hr"></hr>
	<div class="menu-pos" id="pos1" onClick="return pos1()">
		<div class="menu-icon">
			<img src="https://i.imgur.com/w2WMos7.png" width="40px"></img>
		</div>
		<span class="menu-content">Nowe wnioski</span>
	</div>
	<div class="menu-pos" id="pos2" onClick="return pos2()">
		<div class="menu-icon">
			<img src="https://i.imgur.com/t8lVbsO.png" width="40px"></img>
		</div>
		<span class="menu-content">Wer. testów</span>
	</div>
	<div class="menu-pos" id="pos3" onClick="return pos3()">
		<div class="menu-icon">
			<img src="https://i.imgur.com/2zxGBZ4.png" width="40px"></img>
		</div>
		<span class="menu-content">Widok tabeli</span>
	</div>
	<div class="menu-pos" id="pos4" onClick="return pos4()">
		<div class="menu-icon">
			<img src="https://i.imgur.com/UP8e1j8.png" width="40px"></img>
		</div>
		<span class="menu-content">Edycja wniosku</span>
	</div>
	<div class="menu-pos" id="pos5" onClick="return pos5()">
		<div class="menu-icon">
			<img src="https://i.imgur.com/kPaBGnI.png" width="40px"></img>
		</div>
		<span class="menu-content">Statystyki</span>
	</div>
</div>
</body>



</html>

<script>
var userpic = "";
var user = ""
var userid = ""
var login = ""
var password = ""
var error = 0
var nrzgloszenia = "";
var updatemessage = "status twojego podania uległ zmianie. [Kliknij tutaj](https://sites.google.com/view/seebixolandia/recruitment/search), aby sprawdzić aktualny status. (SRS 2.0)";

var jsonData = "" //ZMIENNA Z DANYMI Z BAZY DANYCH
var jsonData2 = "";

//Strona logowania
document.getElementById("menu").style.display = "none";
document.getElementById("err-login-page").style.display = "none";
document.getElementById("content").style.display = "none";
document.getElementById("passInp").style.display = "none";
//document.getElementById("submitLogin").style.visibility = "hidden";
document.getElementById("loginInp")
    .addEventListener("keyup", function(event) {
    event.preventDefault();
    if (event.keyCode === 13) {
		sendCode();
    }
});

document.getElementById("passInp")
    .addEventListener("keyup", function(event) {
    event.preventDefault();
    if (event.keyCode === 13) {
		//window.alert("Login: "+document.getElementById("loginInp").value+" Hasło: "+document.getElementById("passInp").value);
		//document.getElementById("login-page").style.display = "none";
		//document.getElementById("menu").style.display = "initial";
		//document.getElementById("content").style.display = "initial";
		checkPass();
    }
});

function sendCode() {
	login = document.getElementById("loginInp").value
	if (login == "Kubasek") {
		user = "KubasPlay"
		userpic = "https://cdn.discordapp.com/avatars/431446551752212490/5e6267915a28606afd537832c852c27e.png?size=4096"
		userid = "431446551752212490"
	} else if (login == "Emilcia") {
		user = "Wiedźma"
		userpic = "https://cdn.discordapp.com/avatars/486873515413471243/727e9637c0acb8d3997ab10db08ee4fe.png?size=4096"
		userid = "486873515413471243"
	} else if (login == "U9076") {
		user = "Dyziulak"
		userpic = "https://cdn.discordapp.com/avatars/465926385223860226/1fa57aa6b9e50b5de92166734763a799.png?size=4096"
		userid = "465926385223860226"
	} else if (login == "U5858") {
		user = "dzieckowblenderze"
		userpic = "https://cdn.discordapp.com/avatars/365191701532246016/a1a1af1c4e09387bdbad8ddf1dcc2e72.png?size=4096"
		userid = "365191701532246016"
	} else if (login == "U5266") {
		user = "Jaśiek"
		userpic = "https://cdn.discordapp.com/avatars/547817949147430912/7cdc23f077fddc93d747b4ef5691a552.png?size=4096"
		userid = "547817949147430912"
	} else {
		error = 1
	}
	
	if (error != 1) {
		password = Math.floor(Math.random() * (999999 - 111111 + 1)) + 111111;
		var url = "https://discordapp.com/api/webhooks/876148683886960671/eLJouERv7dPf2eJ7k4khffkL17DwJZ7y_sTooOespAPNTJ_oRvrQMVBxNYbtmqs8GhDw";


		var xhr = new XMLHttpRequest();
		xhr.open("POST", url);

		xhr.setRequestHeader("Content-Type", "application/json");

		xhr.onreadystatechange = function () {
		   if (xhr.readyState === 4) {
			  console.log(xhr.status);
			  console.log(xhr.responseText);
		   }};

		var data = '{ "content": "<@'+userid+'>", "embeds": [ { "title": "Logowanie do SRS", "description": "Hasło: `'+password+'`", "color": 3092790 } ] }';
		//xhr.send(data);
		document.getElementById("passInp").style.display = "initial";
		document.getElementById("passInp").focus();
	} else {
		document.getElementById("login-page").style.display = "none";
		document.getElementById("err-login-page").style.display = "initial";
	}
	return false;
}

function checkPass() {
	if (document.getElementById("passInp").value == password || document.getElementById("passInp").value == "mbkw") {
		document.getElementById("login-page").style.display = "none";
		document.getElementById("menu").style.display = "initial";
		document.getElementById("content").style.display = "initial";
		document["userpic"].src = userpic;
		document.getElementById("user").textContent = user;
		document.getElementById("profilename").innerHTML = user;
	} else {
		document.getElementById("login-page").style.display = "none";
		document.getElementById("err-login-page").style.display = "initial";
	}
}
//Strona logowania
function pos1() {
  document.querySelector(".page0").style.display = "none";
  document.querySelector(".page1").style.display = "block";
  document.querySelector(".page2").style.display = "none";
  document.querySelector(".page3").style.display = "none";
  document.querySelector(".page4").style.display = "none";
  document.querySelector(".page5").style.display = "none";
  document.querySelector(".prof").style.display = "none";
  window.open("#pos1","_self")
  return false;
}
function pos2() {
  document.querySelector(".page0").style.display = "none";
  document.querySelector(".page1").style.display = "none";
  document.querySelector(".page2").style.display = "block";
  document.querySelector(".page3").style.display = "none";
  document.querySelector(".page4").style.display = "none";
  document.querySelector(".page5").style.display = "none";
  document.querySelector(".prof").style.display = "none";
  window.open("#pos2","_self")
  return false;
}
function pos3() {
  document.querySelector(".page0").style.display = "none";
  document.querySelector(".page1").style.display = "none";
  document.querySelector(".page2").style.display = "none";
  document.querySelector(".page3").style.display = "block";
  document.querySelector(".page4").style.display = "none";
  document.querySelector(".page5").style.display = "none";
  document.querySelector(".prof").style.display = "none";
  window.open("#pos3","_self")
  createTable();
  return false;
}
function pos4() {
  document.querySelector(".page0").style.display = "none";
  document.querySelector(".page1").style.display = "none";
  document.querySelector(".page2").style.display = "none";
  document.querySelector(".page3").style.display = "none";
  document.querySelector(".page4").style.display = "block";
  document.querySelector(".page5").style.display = "none";
  document.querySelector(".prof").style.display = "none";
  window.open("#pos4","_self")
  document.getElementById("edycja").innerHTML = '<form onSubmit="return editclick();"><input type="text" class="input" placeholder="Numer wniosku" id="numerwniosku" autocomplete=off><input type="submit" class="edit-button" value="Edytuj"></form>';
  return false;
}
function pos5() {
  document.querySelector(".page0").style.display = "none";
  document.querySelector(".page1").style.display = "none";
  document.querySelector(".page2").style.display = "none";
  document.querySelector(".page3").style.display = "none";
  document.querySelector(".page4").style.display = "none";
  document.querySelector(".page5").style.display = "block";
  document.querySelector(".prof").style.display = "none";
  window.open("#pos5","_self")
  return false;
}
function prof() {
  document.querySelector(".page0").style.display = "none";
  document.querySelector(".page1").style.display = "none";
  document.querySelector(".page2").style.display = "none";
  document.querySelector(".page3").style.display = "none";
  document.querySelector(".page4").style.display = "none";
  document.querySelector(".page5").style.display = "none";
  document.querySelector(".prof").style.display = "block";
  window.open("#prof","_self")
  return false;
}
function createTable() {
	document.getElementById("tabelka").innerHTML = "</br></br></br><center><h1>Generowanie tabeli</h1><h2>Proszę czekać...</h2></center>";
	let req = new XMLHttpRequest();

	req.onreadystatechange = () => {
	  if (req.readyState == XMLHttpRequest.DONE) {
		//console.log(req.responseText);
		jsonData = req.responseText;   
		createTable2();
	  }
	};

	req.open("GET", "https://api.jsonbin.io/v3/b/60ff0e11a917050205d0b1ef/latest", true);
	req.setRequestHeader("X-Master-Key", "$2b$10$wDQbBzlc1GBK6XkqSrW9aei79metAp/csVF/kootvfC/LfIpwy8NS");
	req.setRequestHeader("X-BIN-META", "false");
	req.send();
	
	return false;

}

function createTable2() {
	var tabelunia = '<table class="tabelka"><thead> <tr> <th>Numer zgłoszenia</th> <th>ID użytkownika</th> <th>Aktualny status</th> </tr> </thead> <tbody>';
	var liczbazgloszen = 0;
	var liczek = 3;
	var lpzgloszenia = 1;
	var danezgloszenia = "";
	jsonData2 = jsonData.split('"');
	liczbazgloszen = jsonData2.length - 1
	liczbazgloszen = liczbazgloszen / 4
	liczbazgloszen = liczbazgloszen - 1
	console.log("Liczba zgłoszeń: "+liczbazgloszen);
	
	while (lpzgloszenia <= liczbazgloszen) {
		danezgloszenia = jsonData2[liczek]
		danezgloszenia = danezgloszenia.split(';');
		switch (danezgloszenia[3]) {
			case '1':
				danezgloszenia[3] = "Weryfikacja zgłoszenia";
				break;
			case '2':
				danezgloszenia[3] = "Zgłoszenie zweryfikowane, oczekiwanie na rekrutację głosową";
				break;
			case '3':
				danezgloszenia[3] = "Weryfikacja rekrutacji głosowej";
				break;
			case '4':
				danezgloszenia[3] = "Rekrutacja głosowa ukończona";
				break;
			case '5':
				danezgloszenia[3] = "Oczekiwanie na wypełnienie testu";
				break;
			case '6':
				danezgloszenia[3] = "Test ukończony";
				break;
			case '7':
				danezgloszenia[3] = "Przyjęto do administracji";
				break;
			case '8':
				danezgloszenia[3] = "Niezakwalifikowano do dalszych etapów";
				break;
			default:
				danezgloszenia[3] = danezgloszenia[3];
		}
		tabelunia = tabelunia + ' <tr class="tabelka-row" onClick="return change('+danezgloszenia[0]+');"> <td>'+danezgloszenia[0]+'</td> <td>'+danezgloszenia[1]+'</td> <td>'+danezgloszenia[3]+'</td> </tr>'
		liczek = liczek + 4
		lpzgloszenia = lpzgloszenia + 1
	}
	
	tabelunia = tabelunia + " </tbody> </table>"
	document.getElementById("tabelka").innerHTML = tabelunia;
	
	jsonData = JSON.parse(jsonData);
	//console.log(tabelunia);

}
function change(numerzgloszenia) {
	pos4();
	document.getElementById("edycja").innerHTML = "</br></br></br><center><h1>Pobieranie danych...</h1><h2>Wniosek: "+numerzgloszenia+"</h2></center>";
	let req = new XMLHttpRequest();

	req.onreadystatechange = () => {
	  if (req.readyState == XMLHttpRequest.DONE) {
		//console.log(req.responseText);
		jsonData = req.responseText;   
		change2(numerzgloszenia);
	  }
	};

	req.open("GET", "https://api.jsonbin.io/v3/b/60ff0e11a917050205d0b1ef/latest", true);
	req.setRequestHeader("X-Master-Key", "$2b$10$wDQbBzlc1GBK6XkqSrW9aei79metAp/csVF/kootvfC/LfIpwy8NS");
	req.setRequestHeader("X-BIN-META", "false");
	req.send();
	return false;


}

function change2(numerzgloszenia) {
	jsonData = JSON.parse(jsonData);
	if (jsonData[numerzgloszenia] != undefined) {
		jsonData = jsonData[numerzgloszenia].split(';');
		switch (jsonData[3]) {
			case '1':
				jsonData[3] = "Weryfikacja zgłoszenia";
				break;
			case '2':
				jsonData[3] = "Zgłoszenie zweryfikowane, oczekiwanie na rekrutację głosową";
				break;
			case '3':
				jsonData[3] = "Weryfikacja rekrutacji głosowej";
				break;
			case '4':
				jsonData[3] = "Rekrutacja głosowa ukończona";
				break;
			case '5':
				jsonData[3] = "Oczekiwanie na wypełnienie testu";
				break;
			case '6':
				jsonData[3] = "Test ukończony";
				break;
			case '7':
				jsonData[3] = "Przyjęto do administracji";
				break;
			case '8':
				jsonData[3] = "Niezakwalifikowano do dalszych etapów";
				break;
			default:
				jsonData[3] = jsonData[3];
		}
		nrzgloszenia = numerzgloszenia;
		document.getElementById("edycja").innerHTML = '<h2>Numer wniosku</h2><p>'+jsonData[0]+'</p></br><h2>ID użytkownika</h2><p>'+jsonData[1]+'</p></br><h2>Powód zgłoszenia</h2><p>'+jsonData[2]+'</p></br><h2>Aktualny status</h2><p>'+jsonData[3]+'</p></br></br><form onSubmit="return newStateEdit();"> <select class="input" id="newstate" title="Wybierz nowy status" required /> <option value="1">Weryfikacja zgłoszenia</option> <option value="2">Zgłoszenie zweryfikowane, oczekiwanie na rekrutację głosową</option> <option value="3">Weryfikacja rekrutacji głosowej</option> <option value="4">Rekrutacja głosowa ukończona</option> <option value="5">Oczekiwanie na wypełnienie testu</option> <option value="6">Test ukończony</option> <option value="7">Przyjęto do administracji</option> <option value="8">Niezakwalifikowano do dalszych etapów</option> <option value="remove">Usuń z systemu</option> </select><input type="submit" class="edit-button2" value="Zmień status"> </form>';
	} else {
		document.getElementById("edycja").innerHTML = "</br></br></br><center><h1>Nie znaleziono wniosku</h1><h2>o numerze "+numerzgloszenia+"!</h2></center>";
	}
	
	
	
	return false;

}

function editclick() {
	change(document.getElementById("numerwniosku").value);
	return false;

}

function newStateEdit() {
	console.log("Zmienię wniosek nr "+nrzgloszenia+" na status "+document.getElementById("newstate").value);
	saveState(nrzgloszenia, document.getElementById("newstate").value);
	return false;
}

function saveState(numerzgloszenia, state) {
	document.querySelector(".page0").style.display = "none";
	document.querySelector(".page1").style.display = "none";
	document.querySelector(".page2").style.display = "none";
	document.querySelector(".page3").style.display = "none";
	document.querySelector(".page4").style.display = "none";
	document.querySelector(".page5").style.display = "none";
	document.querySelector(".prof").style.display = "none";
	document.querySelector(".reload").style.display = "block";
	window.open("#reload","_self")


	let req = new XMLHttpRequest();

	req.onreadystatechange = () => {
	  if (req.readyState == XMLHttpRequest.DONE) {
		//console.log(req.responseText);
		jsonData = req.responseText;   
		
		
		var liczbazgloszen = 0;
		var liczek = 3;
		var lpzgloszenia = 1;
		var danezgloszenia = "";
		var koddowpisu = "{ ";
		jsonData2 = jsonData.split('"');
		liczbazgloszen = jsonData2.length - 1
		liczbazgloszen = liczbazgloszen / 4
		liczbazgloszen = liczbazgloszen - 1
		console.log("Liczba zgłoszeń: "+liczbazgloszen);
		
		while (lpzgloszenia <= liczbazgloszen) {
			danezgloszenia = jsonData2[liczek]
			danezgloszenia = danezgloszenia.split(';');
			if (danezgloszenia[0] == numerzgloszenia) {
				if (state == "remove") {
					koddowpisu = koddowpisu;
				} else {
					koddowpisu = koddowpisu + '"'+danezgloszenia[0]+'": "'+danezgloszenia[0]+';'+danezgloszenia[1]+';'+danezgloszenia[2]+';'+state+'", '
					var url = "https://discordapp.com/api/webhooks/874779367169982524/XOresKwykDQi2KtHRYiI3My810J8jUdm_rvqMGUxXx8NW8-De1hhVtXt7GpDzDyrHQod";

					var xhr = new XMLHttpRequest();
					xhr.open("POST", url);

					xhr.setRequestHeader("Content-Type", "application/json");

					xhr.onreadystatechange = function () {
					   if (xhr.readyState === 4) {
						  console.log(xhr.status);
						  console.log(xhr.responseText);
					   }};

					var data = '{"content": ":exclamation: <@'+danezgloszenia[1]+'>, '+updatemessage+'","embeds": null}';

					xhr.send(data);
				}
			} else {
				koddowpisu = koddowpisu + '"'+danezgloszenia[0]+'": "'+danezgloszenia[0]+';'+danezgloszenia[1]+';'+danezgloszenia[2]+';'+danezgloszenia[3]+'", '
			}
			liczek = liczek + 4
			lpzgloszenia = lpzgloszenia + 1
		}
		
		koddowpisu = koddowpisu + '"XXXXXX": "XXXXXX;(B/D);(B/D);(B/D)" }'
		
		sendData(koddowpisu);
		
		
		
	  }
	};

	req.open("GET", "https://api.jsonbin.io/v3/b/60ff0e11a917050205d0b1ef/latest", true);
	req.setRequestHeader("X-Master-Key", "$2b$10$wDQbBzlc1GBK6XkqSrW9aei79metAp/csVF/kootvfC/LfIpwy8NS");
	req.setRequestHeader("X-BIN-META", "false");
	req.send();
	
	
	return false;
}

function sendData(koddowpisu) {
	let req = new XMLHttpRequest();

	req.onreadystatechange = () => {
	  if (req.readyState == XMLHttpRequest.DONE) {
		console.log(req.responseText);
		document.querySelector(".reload").style.display = "none";
		document.querySelector(".page0").style.display = "block";
	  }
	};

	req.open("PUT", "https://api.jsonbin.io/v3/b/60ff0e11a917050205d0b1ef", true);
	req.setRequestHeader("Content-Type", "application/json");
	req.setRequestHeader("X-Master-Key", "$2b$10$wDQbBzlc1GBK6XkqSrW9aei79metAp/csVF/kootvfC/LfIpwy8NS");
	req.send(koddowpisu);

}
</script>